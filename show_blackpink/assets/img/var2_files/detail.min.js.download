function handleFollowed(n,t){userId==0&&$("#follow").attr("title",translate.instant("BLOG_AUTHEN_FOLLOW"));$("#total-follow").text(n);parseInt(n)>1&&$(".follower-text").text(translate.instant("BLOG_FOLLOWERS"));t?$("#follow").addClass("followed"):$("#follow").removeClass("followed");userId==0&&$("#follow").addClass("not-allowed");$("#follow").attr("value",t?1:0).addClass(t?"followed":"").empty().append('<i class="cl-icon-rss"><\/i> '+(t?translate.instant("PAGE_Following"):translate.instant("PAGE_Follow")))}function follower(){userId>0&&$("#follow").click(function(){PKLService.get({url:api.follower+"?userId="+ownerId+"&type="+($(this).attr("value")!="1"),OnSuccess:function(n){handleFollowed(n.Data.Total,n.Data.IsFollowed)}})})}function rate(){userId>0&&!isPublish&&$("span.star").click(function(){PKLService.get({url:api.rate+"?contentId="+id+"&value="+$(this).attr("value"),OnSuccess:function(n){if(n.Data!=null){let t=100;t=parseFloat(n.Data.AverageRate)*20+"%";$(".user-rating .star-rating >span.avg-rate").css("width",t);$("#total-rating").text(n.Data.Total);$("#average-rate").text(n.Data.AverageRate)}}})})}function formatDate(n,t){return(!n||n.length<=0)&&(n=new Date),t===!0?moment.utc(n,"YYYY-MM-DD HH:mm:ss [GMT]ZZ").format("YYYY-MM-DD HH:mm:ss [GMT]ZZ"):moment(n,"YYYY-MM-DD HH:mm:ss [GMT]ZZ").format("YYYY-MM-DD HH:mm:ss [GMT]ZZ")}function updateUrlTagPlus(n){return n.indexOf("+")>-1?api.tag+"?tag="+n.split("+").join("%2B"):api.tag+"/"+n}function buildTags(n){var i,r,t;if(n!=null&&n!=""){for(i=n.split(","),r='<div class="row tag-list"><div class="col-md-12 tag-scroll">',t=0;t<i.length;t++)r+='<span><a href="'+updateUrlTagPlus(i[t])+'">'+i[t]+"<\/a><\/span>";return r+"<\/div><\/div>"}return""}function buildAuthor(n){return'<div class="author">\t\t\t    <span>'+translate.instant("BLOG_AUTHOR")+':<\/span>\t\t\t    <a title="'+n.Owner+'" href="'+cvUrl+n.OwnerId+'"><span class="author-name">'+n.Owner+'<\/span><\/a>\t\t\t    <span class="time-icon"><i class="cl-icon-circle"><\/i><\/span>\t\t\t    <span class="time">'+formatDate(n.PublishTime).split(" ")[0]+'<\/span>\t\t\t    <span class="time-icon"><i class="cl-icon-circle"><\/i><\/span>\t\t\t    <span class="comment-icon"><i class="cl-icon-eye"><\/i><\/span>\t\t\t    <span class="comment-text total-view">'+n.TotalViews+'<\/span>    \t\t\t<span class="comment-icon"><i class="cl-icon-share-alt"><\/i><\/span>\t\t\t    <span class="comment-text">'+n.TotalShares+"<\/span>\t\t    <\/div>"}function buildList(n){return'<div class="item"><div class="row">\t\t\t<div class="col-sm-3 image">\t\t\t\t<a href="'+api.view+n.Permalink+'">\t\t\t\t\t<img src="'+s3Storage+n.Thumbnail+'" alt="'+n.Title+'">\t\t\t\t<\/a>\t\t\t<\/div>\t\t\t<div class="col-sm-9 info">\t\t\t\t<div class="top">\t\t\t\t\t<h3><a href="'+api.view+n.Permalink+'">'+n.Title+"<\/a><\/h3>                    "+displayVote(Math.floor(n.AverageRate))+"                    "+$("<p/>").html(n.Summary).text()+'\t\t\t\t<\/div>\t\t\t\t<div class="bottom">\t\t\t\t\t'+buildTags(n.Tag)+buildAuthor(n)+"\t\t\t\t<\/div>\t\t\t<\/div >\t\t<\/div><\/div>"}function displayRelated(n){var r,t,i;if(n&&n.length>0){for(r="",t=0;t<n.length;t++)i=n[t],i.Thumbnail=i.Thumbnail.substr(1),r+=buildList(i);$("#related-items").append(r)}}function displayTopContribute(n){var r,i,t;if(n&&n.length){for(r="",i=0;i<n.length;i++)t=n[i],r+='<div class="row item">\t\t\t            <div class="col-sm-3 avatar">\t\t\t\t            <a href="'+cvUrl+t.UserId+'">\t\t\t\t\t            <img class="level-avatar" src="'+s3Storage+t.UserExpLevel.IconUrl+'">\t\t\t\t\t            <img class="user-avatar" src="'+s3Storage+t.CreatorAvatarUrl+'">\t\t\t\t            <\/a>\t\t\t            <\/div>\t\t\t            <div class="col-sm-9 user-name">\t\t\t\t            <a title="'+t.UserName+'" href="'+cvUrl+t.UserId+'">'+t.UserName+"<\/a>\t\t\t            <\/div>\t\t             <\/div>";$("#list-user").append(r)}}function displayListNew(n){var i,t,r;if(n&&n.length){for(i="",t=0;t<n.length;t++)r=n[t],i+='<div class="item">\t\t\t            <a href="'+api.view+r.Permalink+'">'+r.Title+"<\/a>\t\t               <\/div>";$("#list-items").append(i)}}function displayHashTag(n){var r,i,t;if(n&&n.length>0){for(r="",i=0;i<n.length;i++)t=n[i],t.Name!=""&&(r+='<span><a href="'+updateUrlTagPlus(t.Name)+'">'+t.Name+(t.Total>0?" ("+t.Total+")":"")+"<\/a><\/span>");$("#tag-list").append(r)}}function displayVote(n){var i,t;let r=100;for(r=parseFloat(n)*20,t="",t+='<span style="width:'+r+'%"><\/span>',t+='<span class="vote-rate">',i=1;i<6;i++)t+='<span value="'+i+'" class="star"><i id="img-owner" class="icon ion-ios-star star"><\/i><\/span>';return t+="<\/span>",'<div class="user-rating pull-right">\t\t\t    <div class="star-rating">\t                '+t+"\t\t\t    <\/div>\t\t      <\/div>"}function getSummaryUser(n){PKLService.get({url:api.getUserSumary,OnSuccess:function(t){var i;if(n(),handleFollowed(t.Data.TotalFollow,t.Data.IsFollowed),t.Data.Achievement!=null&&t.Data.Achievement!=""){var r=t.Data.Achievement.split("\n"),u="",f=0;for(i=0;i<r.length;i++)r[i]!=""&&(f++,console.log(r[i]),u+='<li class="'+(i>4?"hide more":"")+'"><i class="cl-icon-check-circle"><\/i><span>'+r[i]+"<\/li>");$("#achievement-owner").empty().append(u);f>5?$("#more-achievement").removeClass("hide"):$("#more-achievement").addClass("hide")}$("#company-owner").text(t.Data.CompanyName+" - "+t.Data.Position);t.Data.Facebook!=null&&t.Data.Facebook!=""?$("#facebook").attr("href",t.Data.Facebook).removeClass("not-allowed"):$("#facebook").removeAttr("target");t.Data.Twitter!=null&&t.Data.Twitter!=""?$("#twitter").attr("href",t.Data.Twitter).removeClass("not-allowed"):$("#twitter").removeAttr("target");t.Data.LinkedIn!=null&&t.Data.LinkedIn!=""?$("#linkedIn").attr("href",t.Data.LinkedIn).removeClass("not-allowed"):$("#linkedIn").removeAttr("target")}})}function getDetail(){PKLService.get({url:api.getDetail,OnSuccess:function(n){userId>0&&loadCommentsTrigger.loadComments();var t=n.Data;ownerId=t.Owner[0].UserId;$("#owner").text(t.Owner[0].UserName).attr("href",cvUrl+t.Owner[0].UserId).attr("title",t.Owner[0].UserName);$("#total-post").attr("href",api.ownerPost+t.Owner[0].UserName).text(t.Owner[0].Total+" "+(t.Owner[0].Total>1?translate.instant("BLOG_POSTS"):translate.instant("BLOG_POST")));$("#owner-level-avatar").attr("src",s3Storage+t.Owner[0].UserExpLevel.IconUrl);$("#owner-user-avatar").attr("src",s3Storage+t.Owner[0].CreatorAvatarUrl);displayTopContribute(t.TopContribute);displayListNew(t.New);displayHashTag(t.HashTags);displayRelated(t.Related);rate()}})}function showMoreAchievement(){$("#more-achievement").click(function(){isShowMore?($("#achievement-owner li").removeClass("hide"),isShowMore=!1,$(this).text(translate.instant("SYSTEM_LABEL_MORE_LESS"))):($("#achievement-owner li.more").addClass("hide"),isShowMore=!0,$(this).text(translate.instant("SYSTEM_LABEL_SEE_MORE")))})}function unOrPublishBlog(){$("#blog-publish").click(function(){var n=confirm(translate.instant("BLOG_CONFIRM"));n==!0&&PKLService.get({url:api.unOrPublishBlog+"&isPublish="+isPublish,OnSuccess:function(n){NOFICATION_GLOBAL?NOFICATION_GLOBAL.update({message:translate.instant(n.Message)}):NOFICATION_GLOBAL=$.notify(translate.instant(n.Message));setTimeout(function(){location.href=api.main},1e3)}})})}function changeOwner(){$("#blog-change-owner").click(function(){var n=prompt(translate.instant("BLOG_WAIT_CONFIRM_CHANGE_OWNER"),"");blockChangeOwner||(n!=null&&n!=""?PKLService.get({url:api.changeOwner+"?blogId="+id+"&userName="+n,OnSuccess:function(n){blockChangeOwner=!1;n&&n.Errors&&n.Errors.length==0&&(NOFICATION_GLOBAL?NOFICATION_GLOBAL.update({message:translate.instant(n.Message)}):NOFICATION_GLOBAL=$.notify(translate.instant(n.Message)),n.Message=="SERVER_MSG_0007"&&setTimeout(function(){location.reload()},1e3))},OnError:function(){blockChangeOwner=!1}}):blockChangeOwner=!1)})}var api={main:"/sharing",getDetail:"sharing/detail/"+blogId+"?isPublish="+preview,view:"/sharing/",unOrPublishBlog:"sharing/hide-or-publish?id="+blogId,rate:"sharing/rate",follower:"api/information/userfollower",getUserSumary:"api/Information/getusersumary?userId="+ownerId,ownerPost:"/sharing/post/",tag:"/sharing/tags",changeOwner:"/sharing/change-owner"},ownerId=0,userName="",blockChangeOwner=!1,isShowMore=!0;document.addEventListener("DOMContentLoaded",function(){translate.onLoad(function(){showMoreAchievement();changeOwner();getSummaryUser(function(){getDetail()});unOrPublishBlog();follower();Prism.highlightAll()})});