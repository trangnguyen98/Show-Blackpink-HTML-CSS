function cdsRequest(){var n=getParameterByName("rq");n=="register"&&($("#loginModal").modal("toggle"),$("ul.nav-tabs li:eq(0)").removeClass("active"),$("#login").removeClass("active"),$("ul.nav-tabs li:eq(1)").addClass("active"),$("#signup").addClass("active"));n=="login"&&$("#loginModal").modal("toggle")}function login(n){localStorage.removeItem(NOTTIFY_USER_ACCESSKEY);var t=location.href.replace(location.origin,"");typeof n=="object"?n.returnurl=t=="/"?"":t:n+="&returnurl="+(t=="/"?"":t);PKLService.post({api:apiLogin.login,loading:$("#frmLogin"),data:n,reCaptchaSiteKey:siteKey,reCaptchaAction:"Login",OnSuccess:function(n){$("#frmLogin")[0].reset();PKLService.loading.addRequest();n!="/"&&location.reload();window.location.href=n},OnError:function(n){n.Code==453?$("#frmLogin .resend-email.hidden").removeClass("hidden"):$("#frmLogin .resend-email").addClass("hidden")}})}function checkLoginState(){isLoadedFacebook==!0?FB.getLoginStatus(function(n){if(n.status==="connected"){var t=n.authResponse.accessToken;FB.api("/me",{fields:"email"},function(n){if(typeof n.email=="undefined"||n.email==""){$.notify("You are logging into facebook without an email. Please update!",{type:"codecamp-danger"});return}var i={email:n.email,token:t,provider:"Facebook"};login(i)})}else n.status==="not_authorized"?facebookSignIn():facebookSignIn()},!0):$.notify(translate.instant("SERVER.MSG_1020"),{type:"codecamp-danger"})}function facebookSignIn(){isLoadedFacebook==!0?FB.login(function(n){if(n.status==="connected"){var t=n.authResponse.accessToken;FB.api("/me",{fields:"email"},function(n){if(typeof n.email=="undefined"||n.email==""){$.notify("You are logging into facebook without an email. Please update!",{type:"codecamp-danger"});return}var i={email:n.email,token:t,provider:"Facebook"};login(i)})}},{scope:"public_profile,email",return_scopes:!0}):$.notify(translate.instant("SERVER.MSG_1020"),{type:"codecamp-danger"})}function googleSignIn(){var n=document.getElementById("googleSignIn");gapi.load("auth2",function(){auth2=gapi.auth2.init({client_id:googleId,cookiepolicy:"single_host_origin",scope:"profile"});auth2.attachClickHandler(n,{},function(n){var t=n.getBasicProfile(),i={email:t.getEmail(),token:gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token,provider:"Google"};login(i)},function(n){console.log("Sign-in error",n)})})}var defaultPage="/",apiLogin={login:"api/users/login",signup:"api/users/CodeCampAccount/register"};$(document).ready(function(){$('.registered-forgot a[data-target="#signup"]').on("click",function(){$("#loginModal ul.nav-tabs li:eq(0)").removeClass("active");$("#loginModal #login").removeClass("active");$("#loginModal ul.nav-tabs li:eq(1)").addClass("active");$("#loginModal #signup").addClass("active")});translate.onLoad(function(){cdsRequest();$("#loginModal").on("shown.bs.modal",function(){$(".grecaptcha-badge").css("visibility","visible")});$("#loginModal").on("hidden.bs.modal",function(){$(".grecaptcha-badge").css("visibility","hidden");$("#frmLogin")[0].reset();LOGIN_VALIDATOR&&LOGIN_VALIDATOR.resetForm()});$(document).on("submit","#frmLogin",function(n){n.preventDefault();LOGIN_VALIDATOR=$(this).validate({rules:{username:{required:!0,minlength:3,maxlength:255,pattern:/^[A-Za-z0-9_.@]+$/},password:{required:!0,minlength:7}},messages:{username:{required:translate.instant("SERVER_MSG_7003"),minlength:translate.instant("PAGES_LOGIN_ERRORS_USERNAME_MINLENGTH"),maxlength:translate.instant("PAGES_LOGIN_ERRORS_USERNAME_MAXLENGTH"),pattern:translate.instant("PAGES_LOGIN_ERRORS_USERNAME_INVALID")},password:{required:translate.instant("SERVER_MSG_7002"),minlength:translate.instant("PAGES_LOGIN_ERRORS_PASSWORD_MINLENGTH")}}});$(this).valid()&&login($("#frmLogin").serialize())});$("#frmSignup").submit(function(n){if(n.preventDefault(),SIGNUP_VALIDATOR=$(this).validate({rules:{email:{required:!0,email:!0},username:{required:!0,minlength:3,maxlength:30,pattern:/^[A-Za-z0-9_.@]+$/},password:{required:!0,minlength:7},cbAgree:{required:!0}},messages:{email:{required:translate.instant("PAGES_SIGNUP_ERRORS_EMAIL_INVALID"),email:translate.instant("SERVER_MSG_7007")},username:{required:translate.instant("SERVER_MSG_7003"),minlength:translate.instant("PAGES_SIGNUP_ERRORS_USERNAME_MINLENGTH"),maxlength:translate.instant("PAGES_SIGNUP_ERRORS_USERNAME_MAXLENGTH"),pattern:translate.instant("PAGES_SIGNUP_ERRORS_USERNAME_INVALID")},password:{required:translate.instant("PAGES_LOGIN_ERRORS_PASSWORD_REQUIRED"),minlength:translate.instant("PAGES_LOGIN_ERRORS_PASSWORD_MINLENGTH")},cbAgree:{required:translate.instant("PAGES_SIGNUP_ERRORS_TERMS_AGREE_REQUIRED")}},errorPlacement:function(n,t){var i=$(t).data("error");i?$(i).append(n):n.insertAfter(t)}}),$(this).valid()){var t=$("#frmSignup").serialize(),i=$('#frmSignup input[name="username"]').val(),r=$('#frmSignup input[name="password"]').val();PKLService.post({api:apiLogin.signup,loading:$("#frmSignup"),data:t+"&confirmpassword="+r,reCaptchaSiteKey:siteKey,reCaptchaAction:"SignUp",OnSuccess:function(n){$.notify(translate.instant(n.Message),{type:"success",delay:1e4});$("#frmSignup")[0].reset();$('#loginModal a[data-target="#login"]').tab("show");$('#frmLogin input[name="username"]').val(i)}})}})})});